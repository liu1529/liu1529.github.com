<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en">
<title type="text">我的博客</title>
<generator uri="https://github.com/mojombo/jekyll">Jekyll</generator>
<link rel="self" type="application/atom+xml" href="/feed.xml" />
<link rel="alternate" type="text/html" href="/" />
<updated>2014-09-17T17:09:21+08:00</updated>
<id>/</id>
<author>
  <name>liu1529</name>
  <uri>/</uri>
  <email>lxl.gmmail@gmail.com</email>
</author>


<entry>
  <title type="html"><![CDATA[iOS UIView]]></title>
  <link rel="alternate" type="text/html" href="/iOS-views/"/>
  <id>/iOS-views</id>
  <published>2014-09-11T00:00:00+08:00</published>
  <updated>2014-09-11T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;p&gt;iOS里面可以说UIView是最重要的类之一，所有界面上的控件都是UIView的子类，UIView继承自UIResponder，UIResponder负责处理事件，而
UIResponder继承自NSObject。NSObject是Cocoa里面绝大部分类的根类。view hierarchy 是view最重要的组织形式，一个view可以拥有subviews，
而一个subview也有一个superview。view hierarchy使view一起出现和移动，当一个view移动时，它的所有subviews也一起移动；当一个view
被删除后，它的所有subviews也被一起删除。&lt;/p&gt;

&lt;h1 id=&quot;the-window&quot;&gt;The Window&lt;/h1&gt;

&lt;p&gt;view hierarchy的顶层元素是app的window，它是UIWindow的一个实例，并继承自UIView。app应该只有一个main window，而且一个屏幕只能
有一个window，它是界面上有效view的最终superview。window必须将设备的屏幕填充满：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;span class=&quot;bp&quot;&gt;UIWindow&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIWindow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIScreen&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;maniScreen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;App 使用 main storyboard&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果你的app使用main storyboard，那么UIApplicationMain会自动实例化一个正确的
UIWindow并将它赋值给app delegate的window属性，然后它会实例化storyboard的initial
view controller并将它赋值给window的rootViewController属性。这些都在app调用
&lt;code&gt;application:didFinnishLaunchingWithOptions&lt;/code&gt;之前完成。
最后，UIApplicationMain会调用&lt;code&gt;makeKeyAndVisible&lt;/code&gt;来显示app的界面，这些在调用&lt;code&gt;application:didFinnishLaunchingWithOptions&lt;/code&gt;
之后完成。&lt;/p&gt;

&lt;p&gt;如果你想子类化window时，你必须在AppDelegate.m文件里面重写window属性的getter函数:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIWindow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;window&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;bp&quot;&gt;UIWindow&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MyWindow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIScreen&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mainScreen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
    &lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_window&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;w&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;App 不使用 main storyboard&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果你的app没有main storyboard，通常使用代码来完成：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIWindow&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIScreen&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mainScreen&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]];&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;// Override point for customization after application launch.&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;whiteColor&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;window&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;makeKeyAndVisible&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;如果你想引用window属性，可以使用application的delegate中的window属性&lt;/p&gt;

&lt;p&gt;&lt;code&gt;UIWindow* w = [[[UIApplication sharedApplication] delegate] window]&lt;/code&gt;&lt;/p&gt;

&lt;h1 id=&quot;superview--subview&quot;&gt;SuperView 和 SubView&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;如果一个view在它的superview上移除或移动，它的所有subview也一起移除或移动。&lt;/li&gt;
  &lt;li&gt;一个view的透明度将会被它的subview继承。&lt;/li&gt;
  &lt;li&gt;如果view的subview的范围超出view的范围，可以不显示subview超出范围部分，这被称为clipping，通过clipsToBounds属性设置。&lt;/li&gt;
  &lt;li&gt;superview负责管理它的subview，当一个subview不再属于它的superview或superview本身被释放时，superview负责释放它的subview。&lt;/li&gt;
  &lt;li&gt;当view的尺寸被改变时，它的subview也可以自动改变。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一个UIView有superview属性和subviews属性，&lt;code&gt;isDescendantOfView:&lt;/code&gt;可以检测一个view是否
是另一个view的subview，不管深度有多深。如果你想引用一个特殊的view，你可以通过outlet，
或通过设置view的tag属性，然后使用&lt;code&gt;viewWithTag:&lt;/code&gt;方法获得。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;addSubview:&lt;/code&gt;方法使一个view成为另一个的subview，&lt;code&gt;removeFromSuperview&lt;/code&gt;方法将一个view
从它的superview的view hierarchy中移除。记住，一个view从它superview移除后，view
将会被释放，如果你还想使用它，你必须先保持(retain)它，通常通过设置属性的retain来完成。&lt;/p&gt;

&lt;p&gt;当这些改变发生时，会发送事件通知，你需要通过子类化来重写这些事件，以处理事件。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;didAddSubview:&lt;/code&gt; &lt;code&gt;willRemoveSubview:&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;didMoveToSuperview:&lt;/code&gt; &lt;code&gt;willMoveToSuperview:&lt;/code&gt; &lt;/li&gt;
  &lt;li&gt;&lt;code&gt;didMoveToWindow:&lt;/code&gt; &lt;code&gt;willMoveToWindow:&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;addSubview&lt;/code&gt;会将view放在superview的最前端，你也可以通过下面的方法，将view插入到view
hierarchy的任意位置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;insertSubview:atIndex:&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;insertSubview:belowSubvie:&lt;/code&gt; &lt;code&gt;insertSubview:aboveSubview:&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;exchangeSubviewAtIndex:withSubviewAtIndex:&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;bringSubviewToFont:&lt;/code&gt; &lt;code&gt;sendSubviewToBack:&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;你可以通过下面的方法，删除所有subview。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subviews&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;removeFromSuperview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;或&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;[view.subviews makeObjectsPerformSelector:@selector(removeFromSuperview)];
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&quot;section&quot;&gt;隐藏和透明&lt;/h1&gt;

&lt;p&gt;通过设置UIView的属性hidden来隐藏view，当view隐藏后通常它不会再接收事件。&lt;/p&gt;

&lt;p&gt;通过设置backgroundColor属性来设置view的背景色，当backgroundColor的属性为nil时，
它拥有一个透明背景。当它的属性为nil时，它可以作为其他views的superview，这样可以使
这些views在同一个view hierarchy中。&lt;/p&gt;

&lt;p&gt;通过设置alpha属性，可以改变view的透明度（1.0表示不透明，0.0表示完全透明）。这将会
影响它的subviews，如果superview的alpha为0.5，那么它的subviews的alpha都不会超过0.5。
（更复杂的是颜色也有alpha属性，例如，一个view的alpha为1.0，它也可以拥有一个透明背景，
因为，它的backgroundColor的alpha小于1.0）。一个view完全透明，相当于设置hidden为YES，
它和它的subviews都会不可见，通常也不会在接收事件。&lt;/p&gt;

&lt;p&gt;view的alpha属性同样会影响它背景色的可见度和它内容的可见度。例如，如果一个view的alpha
小于1，它显示一个图像且有背景色，背景色将会透过图像显示出来（view后面的任何东西都会
穿透显示）。&lt;/p&gt;

&lt;p&gt;view的opaque属性，不会影响view透明度，它对绘制（drawing）系统有影响。当一个view
完全填充它的边界范围，且它的opaque为YES，且alpha属性为1.0，那么提高绘制系统的性能。&lt;/p&gt;

&lt;h1 id=&quot;frame&quot;&gt;Frame&lt;/h1&gt;

&lt;p&gt;view的frame属性，表示view在其superview坐标系中的位置和大小。坐标原点在左上角，
向右为x轴，向下为y轴。&lt;/p&gt;

&lt;h2 id=&quot;bounds-and-center&quot;&gt;Bounds and Center&lt;/h2&gt;

&lt;p&gt;bounds属性表示view在自己的坐标系中的位置和大小，&lt;code&gt;CGRectInset&lt;/code&gt;可以很方便的
将一个view插入到另一个view中：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;UIView *v2 = [[UIView alloc] initWithFrame:CGRectInset(v1.bounds, 10, 10)];
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;改变view的bounds会影响它的frame，同样改变frame会影响bounds，但是改变bounds不会影响
view的center属性。center属性就像frame属性一样，代表view在其superview坐标系中位置，
但是它是bounds的中心位置，它的值就像如图下面表示：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;CGPoint center = CGPointMake(CGRectGetMidX(theView.bounds), 
                             CGRectGetMidY(theView.bounds));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;view 的center是连接view的bounds和它superview的bounds的一个点，改变view的bounds不会改变center，改变center也不会改变bounds。&lt;/p&gt;

&lt;p&gt;view的bounds和center可以清楚的描述view的大小和它在superview中的位置。view的frame属性是多余的，
实际上，frame仅仅用于方便的表达center和bounds的值。使用bounds和center来表示view的大小和它在
superview中所处的位置，更加的合理和可配置。&lt;/p&gt;

&lt;p&gt;每个view都有自己的坐标系（boudns），自己的坐标系和superview坐标系的关系（center）。我们可以转换
在同一个窗口中任意两个view的坐标系，转换支持CGPoint和CGRect之间的双向转换。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;convertPoint:fromVIew:&lt;/code&gt; &lt;code&gt;convertPoint:toView:&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;convertRect:fromView:&lt;/code&gt; &lt;code&gt;convertRect:toView:&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果，第二个参数为nil，表示window。&lt;/p&gt;

&lt;p&gt;例如，如果v2是v1的subview，将v2放在v1的中间，可以使用：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;v2.center ＝ [v1 convertPoint:v1.center fromView:v1.superview];
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;p&gt;当通过center来改变view的位置时，如果view的高或宽不是整数，view将会misaligned，view会显示不正
确。你可以在Simulator中通过Debug-&amp;gt;Color Misaligned Images来检查。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;transfom&quot;&gt;Transfom&lt;/h2&gt;

&lt;p&gt;view 的transform属性，在不改变view的bounds和center的前提下，改变view的大小和方向。transform是一个
CGAffineTransform类型，它相当于6个3＊3的矩阵，详细信息参考
“Transforms” chapter of Apple’s Quartz 2D Pro‐ gramming Guide, especially the section called “The Math Behind the Matrices.”
但是，你不需要知道这些细节，以&lt;code&gt;CGAffineTransformMake&lt;/code&gt;开头的方法，提供了3个基本transform类型：旋转、放大缩小
、移动（translation）。第四种transform类型，比如倾斜、劈开，没有方便函数可供调用。&lt;/p&gt;

&lt;p&gt;默认，view的变换矩阵被称为CGAffineTransformIndentity，应用任何transform都围绕center，center始终
保持不变。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;113&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;132&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;194&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.4&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
 &lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectInset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
 &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.5&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainview&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;transform&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;CGAffineTransformMakeRotation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;45&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;M_PI&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;180.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面演示了将v1旋转45度，v1的center和bounds都没有改变，所以v1的坐标系没有改变，v1的subview v2也
旋转45度，保持v2和v1的相对位置不变。这儿的规则是，如果view的transform不是identity transform，
那么你不应该设置它的frame。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;v1.transform ＝ CGAffineTransformMakeScale(1.8,1);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;对v1的bounds和center同样没有影响，所以subview同样保持和v1相对位置不变。这意味着，v1和v2被同时
缩放。&lt;/p&gt;

&lt;p&gt;应用给一个view的transform可以方便的给另一个view使用，这些方法的名字不不包含“Make”。这些方法不是
无序的，它们是有序的。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;132&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;194&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.4&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.5&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainview&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;先右移100再旋转45度：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;v2.transform = CGAffineTransformMakeTranslation(100,0);
v2.transform = CGAffineTransformRotate(v2.transform, 45 * M_PI / 180.0);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;和先旋转45度再右移100：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;v2.transform = CGAffineTransformMakeRotation(45 * M_PI / 180.0);
v2.transform = CGAffineTransformTranslate(v2.transform, 100.0);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;会得到不同的图形。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;CGAffineTransformConcat&lt;/code&gt;方法使transform矩阵相乘，这也是有序的。先旋转45度再右移100也
可以使用下面的方法：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;CGAffineTransform r = CGAffineTransformMakeRotation(45 * M_PI / 180.0);
CGAffineTransform t = CGAffineTransformMakeTranslation(100, 0);
v2.transform = CGAffineTransformConcat(t,r); //not r,t
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;将已经存在的transform移除，使用对应的invert方法。例如，先旋转45度再右移100，最后移除旋转。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;CGAffineTransform r = CGAffineTransformMakeRotation(45 * M_PI / 180.0);
    CGAffineTransform t = CGAffineTransformMakeTranslation(100, 0); 
v2.transform = CGAffineTransformConcat(t, r);
v2.transform = CGAffineTransformConcat(CGAffineTransformInvert(r), v2.transform);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;最后，没有方便的方法使图形倾斜，可以使用下面的方式：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;v1.transform = CGAffineTransformMake(1, 0, -0.2, 1.0, 0, 0);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;transform可以应用再iOS的核心界面，window的frame和bounds都被锁定到屏幕，不能更改，但是root view
的frame和bounds可以被更改。当设备被旋转90度时，root view也被旋转了90度，{0,0}点移动到了用户的
右上角。root view的subviews在root view的坐标系中，拥有自己的frame，所以它们可以被正确的显示。&lt;/p&gt;

&lt;p&gt;另外，root view的bounds的高和宽被交换，所以可能导致某些界面元素不能被显示出来，请查看下一节如何
解决这个问题。&lt;/p&gt;

&lt;h1 id=&quot;layout&quot;&gt;layout&lt;/h1&gt;

&lt;p&gt;我们已经知道，当superview的bounds的origin改变时，subview会移动。但是，当superview的bounds的size改变时，
 subview的bounds和center都不会改变，superview的bounds的origin也未改变，所以
subview保持在superview左上角的相对位置不变。在实际情况中，我们也许想要当superview的bounds的
size发生变化时，subview也能跟着变化，这被称为layout。&lt;/p&gt;

&lt;p&gt;layout 有三种方法：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Manual layout&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当superview改变尺寸时，它会调用&lt;code&gt;layoutSubviews&lt;/code&gt;方法。提供自己的subclass和重写&lt;code&gt;layoutSubviews&lt;/code&gt;可以手动布局subview。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Autoresizing&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Autoresizing是iOS6之前的自动布局方法，当superview的尺寸变化时，subview根据它的属性autoresizingMask来调整自己尺寸。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Autolayout&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Autolayout在iOS6引进（和前面的系统不兼容），通过view的constraints设置。constraint不仅可以
用于view，还可以用于描述任意两个view之间的关系。constrain可以使你不通过代码，也能实现更加
复杂精确的layoutSubviews函数效果。&lt;/p&gt;

&lt;p&gt;你也可以混用3种layout策略，需要manual layout的情况比较少见。Autoresizing自动使用，除非你
设置superview的autoresizeSubviews属性为NO，或者你在view种使用autolayout替代。Autolayout
是一个可选的技术，你可以用于任何你认为合适的地方，你也可以和autoresizing一起使用。&lt;/p&gt;

&lt;p&gt;在Xcode5的storyboard和xib文件中默认使用autolayout，你可以在File inspector中选中或取消使用。
另一方面，你在代码中创建的界面，默认使用autoresizing，而不是autolayout。&lt;/p&gt;

&lt;h2 id=&quot;autoresizing&quot;&gt;Autoresizing&lt;/h2&gt;

&lt;p&gt;Autoresizing概念上相当于subview的“springs and struts”。spring 可以伸缩，strut不可以，springs和struts可以被设定为
内部的、外部的、水平的、垂直的。因此你可以通过内部springs和structs设置
view的缩放，使用外部springs和struts设置view的位置。例如：&lt;/p&gt;

&lt;p&gt;1.一个subview在superview的中间并且保持在中间，但是当superview的size改变时，它的size也改变。
它拥有外部struct和内部spring。&lt;/p&gt;

&lt;p&gt;2.一个subview在superview的中间并且保持，当superview的size改变时，它的size不改变。那么它
拥有内部struct和外部spring。&lt;/p&gt;

&lt;p&gt;3.一个OK按钮始终在superview的右下角。那么它拥有内部的structs，外部的struts到它的右边和下边
，外部springs到它的上边和左边。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;一个文本输入框在superview的上面，当superview变宽时它也变宽。那么它拥有外部struts，内部的
垂直strut和水平spring。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;在storyboard和xib中使用autoresizing，你需要先在File inspector中取消选中“Use Auto Layout”。
你可以使用Size inspector来设置view的spring和strut，外部的实线表示struct，内部的实线表示
spring。&lt;/p&gt;

&lt;p&gt;在代码中，通过设置view的autoresizingMask属性，这是一个位属性，使用或操作来混用。可以使用
以&lt;code&gt;UIViewAutoresizingFlexible&lt;/code&gt;开头的值来设置spring，不能用于设置strut。默认的UIViewAutoresizingNone，表示所有的strut，
但是实际上它不是所有的strut，它相当于UIViewAutoresizingFlexibleRightMargin和UIViewAutoresizingFlexibleBottomMargin.&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-objc&quot; data-lang=&quot;objc&quot;&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;111&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;132&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;194&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.4&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;132&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;.5&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIView&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;alloc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;initWithFrame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CGRectMake&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
													&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
													&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
														&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;backgroundColor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;UIColor&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;colorWithRed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;green&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;blue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;alpha&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mainview&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;addSubview&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;v2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;autoresizingMask&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIViewAutoresizingFlexibleWidth&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;autoresizingMask&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UIViewAutoresizingFlexibleTopMargin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;
                          &lt;span class=&quot;n&quot;&gt;UIViewAutoresizingFlexibleLeftMargin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;bp&quot;&gt;CGRect&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;50&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;v1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bounds&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面的代码中，当v1的size改变时，v2的宽度也会跟着改变，v3的大小不会改变，它会一直在v1的右下角位置不变。&lt;/p&gt;

&lt;p&gt;当你旋转屏幕后，你的view也应该正确的旋转：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;v1.frame = mainview.bounds;
v1.autoresizingMask = UIViewAutoresizingFlexibleHeight |
                      UIViewAutoresizingFlexibleWidth;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Autoresizing简单有效，但是有时它太简单了。它只能描述suview和superview之间的关系。&lt;code&gt;layoutSubviews&lt;/code&gt;,
方法在autoresizing后调用，所以你的&lt;code&gt;layoutSubviews&lt;/code&gt;可以修正和改变autoresizing没有正确处理的部分。&lt;/p&gt;

&lt;h1 id=&quot;autolayout&quot;&gt;Autolayout&lt;/h1&gt;

&lt;p&gt;Autolayout可能在如下三种情况发生时使用：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;你的代码中，向view加入autolayout constraint。&lt;/li&gt;
  &lt;li&gt;你的app中nib或storyboard选中“Use Auto Layout”，每个nib的view实例将使用autolayout。&lt;/li&gt;
  &lt;li&gt;在你的UIView子类中，重写方法&lt;code&gt;requiresConstraintBasedLayout&lt;/code&gt;返回YES。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;第3中方法，主要用于在切换到autolayout，并在代码添加constraints。通常通过实现view的
&lt;code&gt;updateConstraints&lt;/code&gt;方法，在代码中添加constrains，但是如果&lt;code&gt;requiresConstraintBasedLayout&lt;/code&gt;
返回NO，那么将不会调用&lt;code&gt;updateConstraints&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;一个superview使用autolayout，它的一个或所有subview可以不使用。但是，autolayout会穿透superview
链，所以一个view使用autolayout，那么它的所有superview都会使用autolayout。如果这些view中
有一个view是view controller的main view，那么view controller也会使用autolayout。&lt;/p&gt;

&lt;h2 id=&quot;constraints&quot;&gt;Constraints&lt;/h2&gt;

&lt;p&gt;Autolayout constraints 是一个NSLayoutConstraint实例，用于描述view的绝对高度和宽度，或者
描述一个view和另一个view之间的关系，两个view之间只要有共同的祖先皆可。&lt;/p&gt;

&lt;p&gt;NSLayoutConstraint重要的属性如下：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;firstItem, firstAttribute, secondItem, secondAttribute&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;这个constrain包含两个view各自的属性，如果constrain描述的是view的绝对高度和宽度，第二个view
位nil，第二个view的属性是NSLayoutAttributeNotAnAttribute，其余的属性值：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;NSLayoutAttributeLeft,NSLayoutAttributeRight&lt;/li&gt;
  &lt;li&gt;NSLayoutAttributeTop,NSLayoutAttributeBottom&lt;/li&gt;
  &lt;li&gt;NSLayoutAttributeLeading,NSLayoutAttributeTrailing  &lt;/li&gt;
  &lt;li&gt;NSLayoutAttributeWidth,NSLayoutAttributeHeight&lt;/li&gt;
  &lt;li&gt;NSLayoutAttributeCenterX,NSLayoutAttributeCenterY &lt;/li&gt;
  &lt;li&gt;NSLayoutAttributeBaseline&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;NSLayoutAttributeLeading、NSLayoutAttributeTrailing相当于国际上的NSLayoutAttributeLeft、
NSLayoutAttributeRight，在书写顺序为从右往左国家，它会自动翻转顺序。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;multiplier, constant&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;用于设定第一个属性的值，比如满足等式“第一个属性的值＝第二个属性的值 * multiplier + constant”&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;relation&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;用于设置第2点中等式的操作符，操作符可以可能是等号（NSLayoutRelationEqual），也可能是不等式
NSLayoutRelationLessThanOrEqual, NSLayoutRelationGreaterThanOrEqual&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;priority&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;优先级从1到1000&lt;/p&gt;

&lt;p&gt;一个view可以有多个constraint，UIView有一个constraints属性，通过下面方法添加或删除constrain&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;addConstraint:,addConstraints:&lt;/li&gt;
  &lt;li&gt;removeConstraint:,removeConstraints:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;对于给出的一个constrain，它属于谁呢？它属于它们两个view最近的superview。因此，如果constrain
指示view的绝对高度，那么它属于这个view。如果它描述两个同级view的关系，那么它属于这个两个view的
superview。如果它描述view和它superview之间的关系，那么它属于superview。&lt;/p&gt;

&lt;p&gt;NSLayoutConstraint的属性除了priority和constant都是只读的，如果你想改变已经存在的constraint，
你必须先删除它，再重新添加。&lt;/p&gt;

&lt;h2 id=&quot;autoresizing-constraints&quot;&gt;Autoresizing constraints&lt;/h2&gt;

&lt;p&gt;view的autolayout机制，可能会导致在以前没有使用autolayout的view中引入autolayout。因此，必须
有一种方式，保证当view引入autolayout的时候，它和通过设置frame和autoresizingMask的位置相同。
系统有一个隐士的NSAutoresizingMaskLayoutConstraint来转换为正确的contraint。&lt;/p&gt;

&lt;p&gt;例如，你有一个UILabel的frame是{{20,20},{42,22}}，autoresizingMask为UIViewAutoresizingNone，
如果它突然加入autolayout，它superview会转换它的隐士constrain，它的宽为42、高为22，center X为41，
center Y为31.&lt;/p&gt;

&lt;p&gt;这个转换发生在view的translatesAutoresizingMaskIntoConstraints属性为YES。如果你想要添加
任何清晰的constrain到view，你需要设置translatesAutoresizingMaskIntoConstraints为NO。
否则可能会产生冲突。&lt;/p&gt;

&lt;h2 id=&quot;constraints-1&quot;&gt;代码中创建constraints&lt;/h2&gt;


  &lt;p&gt;&lt;a href=&quot;/iOS-views/&quot;&gt;iOS UIView&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on September 11, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[嵌入式操作系统的上下文切换]]></title>
  <link rel="alternate" type="text/html" href="/RTThread-context-switch/"/>
  <id>/RTThread-context-switch</id>
  <published>2014-06-18T00:00:00+08:00</published>
  <updated>2014-06-18T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;p&gt;我们知道嵌入式操作系统都是多任务操作系统，每个任务都有自己的优先级和时间片，每个任务也有自己独立的堆栈存储数据。当任务执行完
自己的时间片后，操作系统会根据优先级选择任务，然后切换到下一个任务。那么操作系统怎么进行任务切换的？怎么保证切换完成后，
原来任务的数据不丢失，新的任务使用另外一套数据，这就涉及到上下文切换。本文以RT-Thread实时操作系统为例，介绍操作系统的任务
切换和上下文切换。本文的RT-Thread版本为1.2.1，编译环境采用MDK4.73.00。&lt;/p&gt;

&lt;h1 id=&quot;section&quot;&gt;任务&lt;/h1&gt;
&lt;p&gt;任务是操作系统的基本组成单元，我们截取RT-Thread与上下文切换有关的任务定义如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rt_thread&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
 
    &lt;span class=&quot;cm&quot;&gt;/* stack point and entry */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                                     &lt;span class=&quot;cm&quot;&gt;/**&amp;lt; stack point */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                                  &lt;span class=&quot;cm&quot;&gt;/**&amp;lt; entry */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                              &lt;span class=&quot;cm&quot;&gt;/**&amp;lt; parameter */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                             &lt;span class=&quot;cm&quot;&gt;/**&amp;lt; stack address */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint16_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                             &lt;span class=&quot;cm&quot;&gt;/**&amp;lt; stack size */&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;在这里，我们只关心和上下文切换有关的部分。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;sp 为堆栈指针，这是上下文切换的重点&lt;/li&gt;
  &lt;li&gt;entry 为任务入口函数&lt;/li&gt;
  &lt;li&gt;parameter 为入口函数的参数&lt;/li&gt;
  &lt;li&gt;stack_addr 为任务的堆栈指针&lt;/li&gt;
  &lt;li&gt;stack_size 为任务的堆栈大小&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section-1&quot;&gt;任务初始化&lt;/h2&gt;

&lt;p&gt;与上下文切换有关的任务初始化如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;rt_err_t&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;_rt_thread_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rt_thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
                                &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;             &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;             &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;stack_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;kt&quot;&gt;rt_uint8_t&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;priority&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;tick&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
 
    &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* stack init */&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;rt_uint16_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* init thread stack */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;rt_memset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;sc&quot;&gt;&amp;#39;#&amp;#39;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rt_hw_stack_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;entry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;rt_thread_exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;其中的重点是初始化sp指针的部分，&lt;code&gt;rt_hw_stack_init&lt;/code&gt; 定义如下：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;psr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;cm&quot;&gt;/* r4 ~ r7 low register */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* r8 ~ r11 high register */&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;


&lt;span class=&quot;kt&quot;&gt;rt_uint8_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;rt_hw_stack_init&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tentry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                             &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                             &lt;span class=&quot;kt&quot;&gt;rt_uint8_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                             &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt;       &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;texit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;rt_uint8_t&lt;/span&gt;         &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;       &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;stk&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stk&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;rt_uint8_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RT_ALIGN_DOWN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stk&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* init all register */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;sizeof&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xdeadbeef&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r0&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;cm&quot;&gt;/* r0 : argument */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r1&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                        &lt;span class=&quot;cm&quot;&gt;/* r1 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r2&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                        &lt;span class=&quot;cm&quot;&gt;/* r2 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r3&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                        &lt;span class=&quot;cm&quot;&gt;/* r3 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r12&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;                        &lt;span class=&quot;cm&quot;&gt;/* r12 */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lr&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;texit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;     &lt;span class=&quot;cm&quot;&gt;/* lr */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;pc&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;tentry&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;    &lt;span class=&quot;cm&quot;&gt;/* entry point, pc */&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;stack_frame&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;exception_stack_frame&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;psr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0x01000000L&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;              &lt;span class=&quot;cm&quot;&gt;/* PSR */&lt;/span&gt;

    &lt;span class=&quot;cm&quot;&gt;/* return task&amp;#39;s current stack address */&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;figure&gt;
    &lt;img src=&quot;/assets/rt-thread/thread-stack.png&quot; /&gt;
&lt;/figure&gt;

&lt;p&gt;RT-Thread将任务的stack分为两部分，最上面的部分为stack_frame用于存储任务的寄存器信息。
stack_frame又分为两部分，第一部分为R4-R11寄存器，这部分寄存器在MCU进入异常(中断)时
MCU不会自动压栈， 需要在任务切换时，手动存储；另一部为R0-R3、R12、LR、PC、PSR寄存器，
这些寄存器，在进入异常时由硬件自动压入堆栈。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;rt_hw_stack_init&lt;/code&gt;用于初始化每个任务的stack_frame部分。将R4-R7初始化为0xdeadbeef，将
R0初始化为入口函数参数，R1-R3、R12初始化为0，LR为&lt;code&gt;rt_thread_exit&lt;/code&gt;，PC为任务入口函数，
PSR为0x01000000。函数返回后，
&lt;code&gt;thread-sp = thread-&amp;gt;stack_addr + thread-&amp;gt;stack_size - sizeof(struct stack_frame)&lt;/code&gt;
即上图中sp所在位置。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;PSR = APSR + EPSR + IPSR  &lt;br /&gt;
IPSR 当前服务中断号寄存器 &lt;br /&gt;
EPSR 执行状态寄存器（读回来的总是0）。它里面含T位，在Cortex-M中T位必须是1。 &lt;br /&gt;
APSR 上条指令结果的标志 &lt;br /&gt;
具体参考&lt;a href=&quot;http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dui0552a/CHDBIBGJ.html&quot;&gt;ARM&lt;/a&gt; &lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;section-2&quot;&gt;上下文切换&lt;/h1&gt;

&lt;p&gt;所有的上下文切换函数都是用汇编进行书写，为了便于理解，我将其全部翻译为c语言。完整的汇编文件和对应c语言在文后。&lt;/p&gt;

&lt;h2 id=&quot;section-3&quot;&gt;系统首次切换上下文&lt;/h2&gt;

&lt;p&gt;系统初始化完成后，会切换到当前系统中优先级最高的任务。
任务首次进行上下文切换时，调用&lt;code&gt;rt_hw_context_switch_to&lt;/code&gt;。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-asm&quot; data-lang=&quot;asm&quot;&gt;&lt;span class=&quot;err&quot;&gt;;/*&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_context_switch_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_uint32&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;r0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;fucntion&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;used&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;perform&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;switch&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;rt_hw_context_switch_to&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_context_switch_to&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_to_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_from_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOVS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x0&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;interrupt&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOVS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#1&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;priority&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_SHPR3&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_PENDSV_PRI&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#0x00]       ; read&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ORRS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;             &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;modify&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;             &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;write-back&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;trigger&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;causes&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_INT_CTRL&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_PENDSVSET&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;NOP&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;restore&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MSP&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SCB_VTOR&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;NOP&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MSR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;msp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;enable&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;interrupts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;at&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;processor&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;level&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CPSIE&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;I&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;never&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;reach&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;here&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;其对应的c语言为：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-c&quot; data-lang=&quot;c&quot;&gt;&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rt_hw_context_switch_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;rt_uint32_t&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	
	&lt;span class=&quot;n&quot;&gt;rt_interrupt_to_thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rt_interrupt_from_thread&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

	&lt;span class=&quot;c1&quot;&gt;//set the PendSV exception priority(lowest)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;NVIC_SetPriority&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PendSV_IRQn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mh&quot;&gt;0xff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;//trigger the PendSV exception (causes context switch)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;SCB&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ICSR&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;NVIC_PENDSVSET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;//restore MSP&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;__set_MSP&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;uint32_t&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SCB_VTOR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
	&lt;span class=&quot;c1&quot;&gt;//enable interrupts at processor level&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;__enable_irq&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;

	&lt;span class=&quot;c1&quot;&gt;//never reach here&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-asm&quot; data-lang=&quot;asm&quot;&gt;&lt;span class=&quot;nf&quot;&gt;SCB_VTOR&lt;/span&gt;        &lt;span class=&quot;no&quot;&gt;EQU&lt;/span&gt;     &lt;span class=&quot;mi&quot;&gt;0xE000ED08&lt;/span&gt;               &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Vector&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Table&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Offset&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;Register&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;NVIC_INT_CTRL&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;EQU&lt;/span&gt;     &lt;span class=&quot;mi&quot;&gt;0xE000ED04&lt;/span&gt;               &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;interrupt&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;control&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;state&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;register&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;NVIC_SHPR3&lt;/span&gt;      &lt;span class=&quot;no&quot;&gt;EQU&lt;/span&gt;     &lt;span class=&quot;mi&quot;&gt;0xE000ED20&lt;/span&gt;               &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;system&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;priority&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;NVIC_PENDSV_PRI&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;EQU&lt;/span&gt;     &lt;span class=&quot;mi&quot;&gt;0x00FF0000&lt;/span&gt;               &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;priority&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;lowest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;NVIC_PENDSVSET&lt;/span&gt;  &lt;span class=&quot;no&quot;&gt;EQU&lt;/span&gt;     &lt;span class=&quot;mi&quot;&gt;0x10000000&lt;/span&gt;               &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;value&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;trigger&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;exception&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;AREA&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;.text&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;CODE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;READONLY&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;ALIGN&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;THUMB&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;REQUIRE8&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;PRESERVE8&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;IMPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;IMPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_interrupt_from_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;IMPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_interrupt_to_thread&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;;/*&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;rt_base_t&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_interrupt_disable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;rt_hw_interrupt_disable&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt;  &lt;span class=&quot;no&quot;&gt;rt_hw_interrupt_disable&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MRS&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PRIMASK&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CPSID&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;I&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BX&lt;/span&gt;      &lt;span class=&quot;no&quot;&gt;LR&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;;/*&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_interrupt_enable&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_base_t&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;level&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;rt_hw_interrupt_enable&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt;  &lt;span class=&quot;no&quot;&gt;rt_hw_interrupt_enable&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MSR&lt;/span&gt;		&lt;span class=&quot;no&quot;&gt;PRIMASK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BX&lt;/span&gt;		&lt;span class=&quot;no&quot;&gt;LR&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;;/*&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_context_switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_uint32&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_uint32&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;r0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;r1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;rt_hw_context_switch_interrupt&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_context_switch_interrupt&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;rt_hw_context_switch&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_context_switch&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CMP&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#1&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BEQ&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;_reswitch&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOVS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x01&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_from_thread&lt;/span&gt;   &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_interrupt_from_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;_reswitch&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_to_thread&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_interrupt_to_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_INT_CTRL&lt;/span&gt;              &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;trigger&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;causes&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_PENDSVSET&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BX&lt;/span&gt;      &lt;span class=&quot;no&quot;&gt;LR&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;r0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;swith&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;r1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;swith&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;psr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r12&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pushed&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;into&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;from&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;PendSV_Handler&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV_Handler&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;disable&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;interrupt&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;protect&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;switch&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MRS&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PRIMASK&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CPSID&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;I&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CMP&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x00&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BEQ&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;pendsv_exit&lt;/span&gt;                &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pendsv&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;already&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;handled&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;clear&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOVS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x00&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_from_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CMP&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x00&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BEQ&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;swtich_to_thread&lt;/span&gt;        &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;skip&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;save&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;at&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;time&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;MRS&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;psp&lt;/span&gt;                 &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pointer&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;SUBS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x20           ; space for {r4 - r7} and {r8 - r11}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;                &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pointer&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;STMIA&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;          &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r8&lt;/span&gt;                  &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;mov&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r11&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r9&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r10&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r11&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STMIA&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;          &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r11&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;high&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;swtich_to_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_to_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;                &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;load&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pointer&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;LDMIA&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;          &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pop&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;PUSH&lt;/span&gt;    &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;               &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;push&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MSP&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;copy&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r11&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;LDMIA&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;          &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pop&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r11&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;high&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;register&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt;                 &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;mov&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r8&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r11&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r9&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;no&quot;&gt;r5&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r6&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOV&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r11&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;POP&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;               &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pop&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r4&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r7&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MSP&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;MSR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;psp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;                 &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pointer&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;pendsv_exit&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;restore&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;interrupt&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MSR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;PRIMASK&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;MOVS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x04&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;RSBS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x00&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BX&lt;/span&gt;      &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;;/*&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_context_switch_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_uint32&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;r0&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;fucntion&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;used&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;perform&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;first&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;switch&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;*/&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;rt_hw_context_switch_to&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_context_switch_to&lt;/span&gt;
    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_to_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_interrupt_from_thread&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOVS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#0x0&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;interrupt&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;to&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;rt_thread_switch_interrupt_flag&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MOVS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;#1&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;priority&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_SHPR3&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_PENDSV_PRI&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#0x00]       ; read&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ORRS&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r2&lt;/span&gt;             &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;modify&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;             &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;write-back&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;trigger&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;the&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PendSV&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;exception&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;causes&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;context&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_INT_CTRL&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;NVIC_PENDSVSET&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;STR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;NOP&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;restore&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;MSP&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;SCB_VTOR&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;LDR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;NOP&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MSR&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;msp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;enable&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;interrupts&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;at&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;processor&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;level&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;CPSIE&lt;/span&gt;   &lt;span class=&quot;no&quot;&gt;I&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;never&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;reach&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;here&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;!&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;

&lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;compatible&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;old&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;version&lt;/span&gt;
&lt;span class=&quot;nf&quot;&gt;rt_hw_interrupt_thread_switch&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_interrupt_thread_switch&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BX&lt;/span&gt;      &lt;span class=&quot;no&quot;&gt;lr&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;IMPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;rt_hw_hard_fault_exception&lt;/span&gt;

&lt;span class=&quot;nf&quot;&gt;HardFault_Handler&lt;/span&gt;    &lt;span class=&quot;no&quot;&gt;PROC&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;EXPORT&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;HardFault_Handler&lt;/span&gt;

    &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;current&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;context&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;MRS&lt;/span&gt;     &lt;span class=&quot;no&quot;&gt;r0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;psp&lt;/span&gt;                 &lt;span class=&quot;err&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;fault&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;thread&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;stack&lt;/span&gt; &lt;span class=&quot;no&quot;&gt;pointer&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;PUSH&lt;/span&gt;    &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;lr&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;BL&lt;/span&gt;      &lt;span class=&quot;no&quot;&gt;rt_hw_hard_fault_exception&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;POP&lt;/span&gt;     &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;no&quot;&gt;pc&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;nf&quot;&gt;ENDP&lt;/span&gt;

    &lt;span class=&quot;nf&quot;&gt;END&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;p&gt;&lt;a href=&quot;/RTThread-context-switch/&quot;&gt;嵌入式操作系统的上下文切换&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on June 18, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[Android 组件(view)的权重(weight)]]></title>
  <link rel="alternate" type="text/html" href="/android-view-weight/"/>
  <id>/android-view-weight</id>
  <published>2014-05-09T00:00:00+08:00</published>
  <updated>2014-05-09T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;p&gt;当使用如下布局时：&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;LinearLayout&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:orientation=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;horizontal&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;xmlns:android=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;EditText&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@+id/edit_msg&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@string/edit_msg&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Button&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_weight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@+id/btn_send&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@string/btn_send&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LinearLayout&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;button可以正常工作，但是当在text field输入很长的数据时，text field会挤占button的空间，最终使button“消失”。使用weigh可以很好的解决这个问题。&lt;/p&gt;

&lt;p&gt;weigh的值表示应该屏幕应为其保留的空间。如，一个view的weigh为2，第二个view为1，总共为3。所以第一个view占据2/3保留空间，第二个view占据剩下的空间。如果添加第三个weigh为1的view，那么第一个view现在占据1/2保留空间，第三个view得到1/4空间。&lt;/p&gt;

&lt;p&gt;所有views的默认weigh为0，所以如果你只给一个view设置任何大于0的weigh值，那么这个view将具有其他所有views的剩余空间。所以，在本例中，设置EditText的weigh为1，而不设置button的weigh。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;EditText&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_weight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;为了得到更好的布局效果，应该将EditText的width设置为零(0dp).设置width为0，可以提供布局的性能，因为”wrap_content”会去计算文本的宽度。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;EditText&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_weight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;0dp&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;最终的布局文件如下:&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;LinearLayout&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:orientation=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;horizontal&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;xmlns:android=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;nt&quot;&gt;&amp;lt;EditText&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_weight=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;0dp&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@+id/edit_msg&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:hint=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@string/edit_msg&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Button&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@+id/btn_send&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;@string/btn_send&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
    
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LinearLayout&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;


  &lt;p&gt;&lt;a href=&quot;/android-view-weight/&quot;&gt;Android 组件(view)的权重(weight)&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 09, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[Android 事件处理机制]]></title>
  <link rel="alternate" type="text/html" href="/android-handle-event/"/>
  <id>/android-handle-event</id>
  <published>2014-05-08T00:00:00+08:00</published>
  <updated>2014-05-08T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;h1 id=&quot;section&quot;&gt;概述&lt;/h1&gt;

&lt;p&gt;Android包含两套事件处理机制：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;基于监听的事件处理&lt;/li&gt;
  &lt;li&gt;基于回调的事件处理&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一般来说，基于回调的事件处理用于处理一些具有通用性的事件，基于回调的事件处理代码会
显得比较简洁。但对于某些特定的事件，无法使用基于回调的事件处理，只能采用基于监听的
事件处理。&lt;/p&gt;

&lt;h1 id=&quot;section-1&quot;&gt;基于监听的事件处理&lt;/h1&gt;

&lt;h2 id=&quot;section-2&quot;&gt;监听的处理模型&lt;/h2&gt;

&lt;p&gt;在监听的处理模型中，主要涉及三类对象。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Event Source（事件源）：事件发生的场所，通常为各个组件，如按钮、窗口等。&lt;/li&gt;
  &lt;li&gt;Event（事件）：事件封装界面上发生的特定事情。一般通过Event对象取得事件的相关信息。&lt;/li&gt;
  &lt;li&gt;Event Listener（事件监听器）：负责监听事件源发生的事件，并做出相应的响应。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;基于监听的时间处理模型的编程步骤如下：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;获取普通界面组件（事件源），也就是被监听的对象。&lt;/li&gt;
  &lt;li&gt;实现事件监听器类，必须实现一个XxxListener接口。&lt;/li&gt;
  &lt;li&gt;调用时间源的setXxxListener方法将事件监听器对象注册给普通组件。&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;section-3&quot;&gt;内部类作为事件监听器类&lt;/h3&gt;

&lt;p&gt;使用内部类可以在当前类中复用该监听器类；因为监听器是外部类的内部类，所有可以只用
访问外部类的所有界面组件。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MainAct&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//获取应用的bn按钮&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;bn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; 
        &lt;span class=&quot;c1&quot;&gt;//绑定事件监听器&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyClikListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;());&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//定义单击事件监听器&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MyClickListener&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OnClickListener&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//实现监听器必须实现的方法，该方法作为事件处理器&lt;/span&gt;
        &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            
        &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;section-4&quot;&gt;外部类作为事件监听器类(不推荐)&lt;/h3&gt;

&lt;p&gt;使用外部类定义事件监听器比较少见，主要原因如下：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;事件监听器通常属于特定的GUI界面，定义成外部类不利于提高程序的内聚性。&lt;/li&gt;
  &lt;li&gt;外部类形式的事件监听器不能自由访问创建GUI界面的类中组件，编程不够简洁。&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;SendSmsListener&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OnLongClickListener&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;activity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SendSmsListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;activity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                           &lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;activity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;address&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onLongClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;addressStr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentStr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;SmsManager&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;smsManager&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SmsManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getDefault&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;PendingIntent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sendIntent&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PendingIntent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getBroadcast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;activity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;Intent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;smsManager&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;sendTextMessage&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;addressStr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;contentStr&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;sendIntent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Toast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;makeText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;activity&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;短信发送完成&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Toast&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;LENGTH_LONG&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;


    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt; 
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity_main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EditText&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnLongClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;SendSmsListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;content&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;));&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;不推荐将业务逻辑实现写在事件监听器中，包含业务逻辑的事件监听器将导致程序的显示
逻辑和业务逻辑耦合，增加程序的耦合度。如果有多个事件监听器需要相同的业务逻辑功能，
可以考虑使用业务逻辑组件定义业务逻辑功能，再让事件监听器来调用业务逻辑组件的业务
逻辑方法&lt;/p&gt;

&lt;h3 id=&quot;activity&quot;&gt;Activity本身作为事件监听器&lt;/h3&gt;

&lt;p&gt;这种形式非常简洁，但是有两个缺点：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;可能造成程序结果混乱，Activity的主要职责应该是完成界面初始化工作&lt;/li&gt;
  &lt;li&gt;如果Activity界面类需要实现监听器接口，让人改进比较怪异&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OnClickListener&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity_main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//直接使用Activity作为事件监听器&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//实现事件处理方法&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;section-5&quot;&gt;匿名内部类作为事件监听器类（最常用）&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity_main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OnClickListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;

            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;section-6&quot;&gt;直接绑定到标签&lt;/h3&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;LinearLayout&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:orientation=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;vertical&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;xmlns:android=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!--在标签页中为按钮绑定事件处理方法--&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Button&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;click me&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:onClick=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;clickHandler&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LinearLayout&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity_main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//定义一个事件处理方法&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;//其中source代表事件源&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;clickHandler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h2 id=&quot;section-7&quot;&gt;基于回调的事件处理&lt;/h2&gt;

&lt;h3 id=&quot;section-8&quot;&gt;回调机制与监听机制&lt;/h3&gt;

&lt;p&gt;对于回调的事件处理模型来说，事件源和事件监听器是统一的，或者说事件监听器完全消失了。
当用户在GUI组件上激活某个事件时，组件自己特定的方法会负责处理该事件。&lt;/p&gt;

&lt;p&gt;为了使用回调机制类处理GUI组件上所发生的事情，我们需要为该组件提供对应的事件处理
方法—继承GUI组件，并重写该类的时间处理方法来实现。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MyButton&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyButton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Context&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AttributeSet&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onKeyDown&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onKeyDown&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keyCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;app&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;the onKeyDown in MyButton&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//该事件不会向外扩散&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;上面自定义的MyButton类中，我们重写了Button类的onKeyDown(int keyCode, KeyEvent event)方法，
该方法负责处理按钮上的键盘事件。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;LinearLayout&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:orientation=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;vertical&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;fill_parent&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;na&quot;&gt;xmlns:android=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;http://schemas.android.com/apk/res/android&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- 使用自定义View时应使用全限定类名--&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;com.example.test.app.MyButton&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_width=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:layout_height=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;wrap_content&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;na&quot;&gt;android:text=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;click me&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LinearLayout&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;h3 id=&quot;section-9&quot;&gt;基于回调的事件传播&lt;/h3&gt;

&lt;p&gt;几乎所有基于回调的事件处理方法都有一个&lt;code&gt;boolean&lt;/code&gt;类型的返回值，返回值用于标识该处理
方法是否完全处理该事件。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;如果返回true，表明该处理方法已完全处理该事件，事件不会传播出去。&lt;/li&gt;
  &lt;li&gt;如果返回false，表明该处理方法未完全处理该事件，事件会传播出去。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;对于基于回调事件传播而言，某组件上所发生的事情不仅激发该组件上的回调方法，也会触发
该组件所在Activity的回调方法—只要事件能传播到该Activity。&lt;/p&gt;

&lt;p&gt;下面的程序示范Android系统事件传播，程序重写Button类的onKeyDown方法，而且重写了该
Button所在Activity的onKeyDown方法—而且程序没有阻止事件传播。&lt;/p&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MyButton&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;MyButton&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Context&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AttributeSet&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onKeyDown&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onKeyDown&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keyCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;app&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;the onKeyDown in MyButton&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//该事件依然会向外扩散&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;MainActivity&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Activity&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bundle&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onCreate&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;savedInstanceState&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;setContentView&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;layout&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;activity_main&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

        &lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Button&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;findViewById&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;show&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;bn&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setOnKeyListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;View&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;OnKeyListener&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
            &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;View&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;view&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;//只处理按下键的事件&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keyEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getAction&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyEvent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;ACTION_DOWN&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;n&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;-Lisenter-&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;the onKeyDown in Listener&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
                &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
                &lt;span class=&quot;c1&quot;&gt;//该事件未处理完&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;c1&quot;&gt;//重写onKeyDown方法，该方法可监听它所包含的所有组件的按键按下事件&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@Override&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;onKeyDown&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;keyCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;KeyEvent&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;kd&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;onKeyDown&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;keyCode&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;event&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;Log&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;-Activity-&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;the onKeyDown in Activity&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
        &lt;span class=&quot;c1&quot;&gt;//该事件未处理完，依然向外传播&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;按下按键时，log窗口输出：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;05-08 04:48:48.301: V/-Lisenter-(2955): the onKeyDown in Listener
05-08 04:48:48.301: V/app(2955):        the onKeyDown in MyButton
05-08 04:48:48.301: V/-Activity-(2955): the onKeyDown in Activity
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;可以看出Android系统最先触发的应该是按键上绑定的事件监听器，接着触发该组件提供的
事件回调方法，然后传播到该组件所在的Activity。&lt;/p&gt;

&lt;p&gt;对比Android提供的两种事件处理模型，不难发现基于监听的事件处理模型具有更大的优势：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;分工更明确，事件源、事件监听由两个类分开实现，具有更好的可维护性。&lt;/li&gt;
  &lt;li&gt;Android的事件处理机制保证基于监听的事件监听器会被优先触发。&lt;/li&gt;
&lt;/ul&gt;

  &lt;p&gt;&lt;a href=&quot;/android-handle-event/&quot;&gt;Android 事件处理机制&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 08, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[vim 键值表]]></title>
  <link rel="alternate" type="text/html" href="/vim-keymap/"/>
  <id>/vim-keymap</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;figure&gt;
    &lt;img src=&quot;/assets/vim-keymap.png&quot; /&gt;
&lt;/figure&gt;

  &lt;p&gt;&lt;a href=&quot;/vim-keymap/&quot;&gt;vim 键值表&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux学习笔记--系统管理]]></title>
  <link rel="alternate" type="text/html" href="/linux-base-note-system-manage/"/>
  <id>/linux-base-note-system-manage</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;iframe width=&quot;800&quot; height=&quot;600&quot; src=&quot;/assets/linux-base-note/system-manage.swf&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;

  &lt;p&gt;&lt;a href=&quot;/linux-base-note-system-manage/&quot;&gt;linux学习笔记--系统管理&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux学习笔记--开机和bootloader]]></title>
  <link rel="alternate" type="text/html" href="/linux-base-note-power-and-bootloader/"/>
  <id>/linux-base-note-power-and-bootloader</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;iframe width=&quot;800&quot; height=&quot;600&quot; src=&quot;/assets/linux-base-note/power-and-bootloader.swf&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;

  &lt;p&gt;&lt;a href=&quot;/linux-base-note-power-and-bootloader/&quot;&gt;linux学习笔记--开机和bootloader&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux学习笔记--文件系统]]></title>
  <link rel="alternate" type="text/html" href="/linux-base-note-file-system/"/>
  <id>/linux-base-note-file-system</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;iframe width=&quot;800&quot; height=&quot;600&quot; src=&quot;/assets/linux-base-note/file-system.swf&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;

  &lt;p&gt;&lt;a href=&quot;/linux-base-note-file-system/&quot;&gt;linux学习笔记--文件系统&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux学习笔记--磁盘管理]]></title>
  <link rel="alternate" type="text/html" href="/linux-base-note-disk-manage/"/>
  <id>/linux-base-note-disk-manage</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;iframe width=&quot;800&quot; height=&quot;600&quot; src=&quot;/assets/linux-base-note/disk-manage.swf&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;

  &lt;p&gt;&lt;a href=&quot;/linux-base-note-disk-manage/&quot;&gt;linux学习笔记--磁盘管理&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux学习笔记--基础概念]]></title>
  <link rel="alternate" type="text/html" href="/linux-base-note-base/"/>
  <id>/linux-base-note-base</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;iframe width=&quot;800&quot; height=&quot;600&quot; src=&quot;/assets/linux-base-note/base.swf&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;

  &lt;p&gt;&lt;a href=&quot;/linux-base-note-base/&quot;&gt;linux学习笔记--基础概念&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux学习笔记--账户管理]]></title>
  <link rel="alternate" type="text/html" href="/linux-base-note-account/"/>
  <id>/linux-base-note-account</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;iframe width=&quot;800&quot; height=&quot;600&quot; src=&quot;/assets/linux-base-note/account.swf&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;

  &lt;p&gt;&lt;a href=&quot;/linux-base-note-account/&quot;&gt;linux学习笔记--账户管理&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux学习笔记--shell]]></title>
  <link rel="alternate" type="text/html" href="/linux-base-note-SHELL/"/>
  <id>/linux-base-note-SHELL</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;iframe width=&quot;800&quot; height=&quot;600&quot; src=&quot;/assets/linux-base-note/shell.swf&quot; frameborder=&quot;0&quot;&gt; &lt;/iframe&gt;

  &lt;p&gt;&lt;a href=&quot;/linux-base-note-SHELL/&quot;&gt;linux学习笔记--shell&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[git 学习笔记]]></title>
  <link rel="alternate" type="text/html" href="/git-note/"/>
  <id>/git-note</id>
  <published>2014-05-03T00:00:00+08:00</published>
  <updated>2014-05-03T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;figure&gt;
    &lt;img src=&quot;/assets/git-note.png&quot; /&gt;
&lt;/figure&gt;

  &lt;p&gt;&lt;a href=&quot;/git-note/&quot;&gt;git 学习笔记&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on May 03, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[windows安装jekyll]]></title>
  <link rel="alternate" type="text/html" href="/windows-install-jekyll/"/>
  <id>/windows-install-jekyll</id>
  <published>2014-04-30T00:00:00+08:00</published>
  <updated>2014-04-30T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#ruby&quot;&gt;1.安装Ruby&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ruby-devkit&quot;&gt;2.安装Ruby DevKit&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#jekyll&quot;&gt;3.安装jekyll&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#python-easyinstall&quot;&gt;4.安装python easy_install&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#pygments&quot;&gt;5.安装pygments&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#jekyll-1&quot;&gt;6.运行jekyll&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot;&gt;7.问题解决&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#ruby-1&quot;&gt;7.1 ruby版本问题&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#jekyll-2&quot;&gt;7.2 jekyll源问题&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#python&quot;&gt;7.3 python问题&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot;&gt;7.4 中文编码问题&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-2&quot;&gt;8. 参考&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ruby&quot;&gt;1.安装Ruby&lt;/h2&gt;
&lt;p&gt;下载&lt;a href=&quot;http://rubyinstaller.org/downloads/&quot;&gt;Ruby&lt;/a&gt;，安装到c:\ruby，Ruby版本请选择1.9.3。&lt;/p&gt;

&lt;h2 id=&quot;ruby-devkit&quot;&gt;2.安装Ruby DevKit&lt;/h2&gt;
&lt;p&gt;下载&lt;a href=&quot;http://rubyinstaller.org/downloads/&quot;&gt;Ruby Development Kit&lt;/a&gt;，解压到c:\devkit，然后在c:\devkit下输入：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ruby dk.rb init
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;生成config.yml&lt;/p&gt;

&lt;p&gt;查看config.yml文档，文档内容应该有下面类似的结构：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# This configuration file contains the absolute path locations of all
# installed Rubies to be enhanced to work with the DevKit. This config
# file is generated by the &#39;ruby dk.rb init&#39; step and may be modified
# before running the &#39;ruby dk.rb install&#39; step. To include any installed
# Rubies that were not automagically discovered, simply add a line below
# the triple hyphens with the absolute path to the Ruby root directory.
#
# Example:
#
# ---
# - C:/ruby19trunk
# - C:/ruby192dev
#
---
- C:/Ruby193 
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;jekyll&quot;&gt;3.安装jekyll&lt;/h2&gt;
&lt;p&gt;在c:\devkit\的命令行输入&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ruby dk.rb install
gem sources --remove http://rubygems.org/
gem sources -a http://ruby.taobao.org/
gem sources -l
*** CURRENT SOURCES ***
http://ruby.taobao.org  
gem install jekyll  
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;python-easyinstall&quot;&gt;4.安装python easy_install&lt;/h2&gt;
&lt;p&gt;python的版本的必须为2.7，不能为3.0。如果系统安装两个python版本，修改环境变量，使运行python版本为2.7。&lt;/p&gt;

&lt;p&gt;下载安装&lt;a href=&quot;http://pypi.python.org/pypi/distribute&quot;&gt;easy_install&lt;/a&gt; &lt;/p&gt;

&lt;h2 id=&quot;pygments&quot;&gt;5.安装pygments&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;easy_install Pygments
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;jekyll-1&quot;&gt;6.运行jekyll&lt;/h2&gt;

&lt;pre&gt;&lt;code&gt;jekyll new blog
cd blog
jekyll serve
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;section&quot;&gt;7.问题解决&lt;/h2&gt;

&lt;h3 id=&quot;ruby-1&quot;&gt;7.1 ruby版本问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;jekyll serve
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;出现&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Generating...   Liquid Exception: cannot load such file -- yajl/2.0/yajl
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;请安装ruby版本1.9.3&lt;/p&gt;

&lt;h3 id=&quot;jekyll-2&quot;&gt;7.2 jekyll源问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;gem install jekyll 出现：

ERROR:  Could not find a valid gem &#39;jekyll&#39; (&amp;gt;= 0) in any repository
ERROR:  While executing gem ... (Gem::RemoteFetcher::FetchError)
Errno::ECONNREFUSED: No connection could be made because the target machine
actively refused it. - connect(2) (https://rubygems.org/latest_specs.4.8.gz) 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;参考&lt;a href=&quot;https://github.com/jekyll/jekyll/issues/1409&quot;&gt;这个链接&lt;/a&gt; 得出解决方案：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ gem sources --remove http://rubygems.org/
$ gem sources -a http://ruby.taobao.org/
$ gem sources -l
*** CURRENT SOURCES ***
http://ruby.taobao.org  
%gem install rack
gem install jekyll
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;python&quot;&gt;7.3 python问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;jekyll serve 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;出现如下错误：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Configuration file: c:/blog/_config.yml
        Source: c:/blog
   Destination: c:/blog/_site
  Generating... C:/Ruby193/lib/ruby/gems/1.9.1/gems/posix-spawn-0.3.8/lib/po
six/spawn.rb:162: warning: cannot close fd before spawn
&#39;which&#39; 不是内部或外部命令，也不是可运行的程序
或批处理文件。
[31m  Liquid Exception: Failed to get header. in _posts/2014-04-29-welcome-to-j
ekyll.markdown [0m
error: Failed to get header.. Use --trace to view backtrace
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;请安装python版本2.7和pygments&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;7.4 中文编码问题&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;jekyll serve
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;出现&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Generating... Error reading file c:/blog/_posts/2014-04-29-welcome-to-jeky
ll.markdown: invalid byte sequence in GBK
error: invalid byte sequence in GBK. Use --trace to view backtrace
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;在C:\Ruby193\lib\ruby\gems\1.9.1\gems\jekyll-1.5.1\lib\jekyll\convertible.rb的38行&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;self.content = File.read_with_options(File.join(base, name)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;改为&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;opts = {:encoding=&amp;gt;&quot;utf-8&quot;}`
self.content = File.read_with_options(File.join(base, name)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;或者&lt;/p&gt;

&lt;p&gt;在_config.yml中加入&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;encoding:utf-8
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;section-2&quot;&gt;8. 参考&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;http://www.madhur.co.in/blog/2011/09/01/runningjekyllwindows.html&quot;&gt;http://www.madhur.co.in/blog/2011/09/01/runningjekyllwindows.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/yevon/p/3310857.html&quot;&gt;http://www.cnblogs.com/yevon/p/3310857.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://liouys.github.io/jekyll/2013/06/10/jekyll-usage-faq.html&quot;&gt;http://liouys.github.io/jekyll/2013/06/10/jekyll-usage-faq.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.cnblogs.com/yevon/p/3310857.html&quot;&gt;http://www.cnblogs.com/yevon/p/3310857.html&lt;/a&gt;&lt;/p&gt;


  &lt;p&gt;&lt;a href=&quot;/windows-install-jekyll/&quot;&gt;windows安装jekyll&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on April 30, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[linux安装jekyll]]></title>
  <link rel="alternate" type="text/html" href="/linux-install-jekyll/"/>
  <id>/linux-install-jekyll</id>
  <published>2014-04-29T00:00:00+08:00</published>
  <updated>2014-04-29T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;h1 id=&quot;jekyll-&quot;&gt;jekyll 安装&lt;/h1&gt;
&lt;p&gt;以下内容主要参考&lt;a href=&quot;http://jekyllcn.com/&quot;&gt;jekyll中文官网&lt;/a&gt;。笔者使用的OS为ubuntu。&lt;/p&gt;

&lt;h2 id=&quot;ruby-&quot;&gt;ruby 安装&lt;/h2&gt;
&lt;p&gt;jekyll依赖Ruby，RubyGems，如果计算机没有安装，应先使用&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get install ruby
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;安装ruby，这儿必须注意：&lt;/p&gt;

&lt;p&gt;ruby的版本必须在1.9.1以上，否则安装jekyll会出错，笔者的OS默认安装的是1.8，所以必须使用&lt;code&gt;sudo apt-get install ruby1.9.1&lt;/code&gt; 安装ruby
## jekyll 安装
安装完ruby后，使用&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;gem install jekyll 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;安装jekyll&lt;/p&gt;

&lt;h2 id=&quot;jekyll--1&quot;&gt;jekyll 示例&lt;/h2&gt;

&lt;p&gt;安装完成jekyll后，使用如下命令&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;jekyll new mybolg
cd mybolg
jekyll serve
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;创建一个简单的示例。在浏览器中输入：&lt;code&gt;localhost:4000&lt;/code&gt;即可浏览生成的博客界面。
修改_posts文件夹下面的文件，即可修改发表的文章。参考_posts文件夹下面的文件，使用类似的文件命名方式，即可新建文章。&lt;/p&gt;

&lt;h2 id=&quot;github-page&quot;&gt;github page的使用&lt;/h2&gt;

&lt;p&gt;完成上面后，已经可以jekyll新建和修改文章。下面讲述如何使用github page页面，建立自己的个人主页。&lt;/p&gt;

&lt;p&gt;首先，在github上建立新建一个仓库，仓库的名称为&lt;code&gt;username.github.io&lt;/code&gt;。然后，将仓库clone到本地，在本地进行一次push。最后，在github的仓库设置界面，找到GitHub Pages选项，在下面可以看到自己的主页地址，如果设置正确，主页地址应该为&lt;code&gt;username.github.io&lt;/code&gt;的形式。在浏览器中输入&lt;code&gt;username.github.com&lt;/code&gt;或&lt;code&gt;username.github.io&lt;/code&gt;就可以看见自己的主页。&lt;/p&gt;


  &lt;p&gt;&lt;a href=&quot;/linux-install-jekyll/&quot;&gt;linux安装jekyll&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on April 29, 2014.&lt;/p&gt;</content>
</entry>


<entry>
  <title type="html"><![CDATA[我的github博客]]></title>
  <link rel="alternate" type="text/html" href="/github-blog-start/"/>
  <id>/github-blog-start</id>
  <published>2014-04-29T00:00:00+08:00</published>
  <updated>2014-04-29T00:00:00+08:00</updated>
  <author>
    <name>liu1529</name>
    <uri></uri>
    <email>lxl.gmmail@gmail.com</email>
  </author>
  <content type="html">&lt;p&gt;今天开始使用github建立个人博客，发现以前自己在开发阶段的很多经验都没有记录下来，建立博客，可以使自己的经验分享出来，也是对自己工作的总结与思考。经过一番考虑，决定使用github+jekyll+markdown，而不是使用csdn等其他网站提供的博客平台，主要原因如下：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;github可以得到很简短的顶级域名形式，如&lt;a href=&quot;http://liu1529.github.com&quot;&gt;liu1529.github.com&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;将github的博客主页可以放在简历上，毕竟github很难作假。&lt;/li&gt;
  &lt;li&gt;使用jekyll可以学习一些web前端技术，可以学以致用。&lt;/li&gt;
&lt;/ul&gt;


  &lt;p&gt;&lt;a href=&quot;/github-blog-start/&quot;&gt;我的github博客&lt;/a&gt; was originally published by liu1529 at &lt;a href=&quot;&quot;&gt;我的博客&lt;/a&gt; on April 29, 2014.&lt;/p&gt;</content>
</entry>

</feed>
