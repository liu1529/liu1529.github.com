<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>iOS UIView &#8211; 我的博客</title>
<meta name="description" content="欢迎来到我的博客">
<meta name="keywords" content="iOS, UIView">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS UIView">
<meta property="og:description" content="欢迎来到我的博客">
<meta property="og:url" content="/iOS-views/">
<meta property="og:site_name" content="我的博客">





<link rel="canonical" href="/iOS-views/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="我的博客 Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
	        
			<li>
				
					<a href="/about/">About</a>
				 
			</li>
	        
			<li>
				
					<a href="/articles/">Articles</a>
				 
			</li>
	        
			<li>
				
					<a href="/tags/">Tags</a>
				 
			</li>
	        
	        <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead">
	<div class="wrap">
        
    		<a href="/" class="site-logo" rel="home" title="我的博客"><img src="/images/site-logo.png" width="200" height="200" alt="我的博客 logo" class="animated fadeInUp"></a>
        
        <h1 class="site-title animated fadeIn"><a href="/">我的博客</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">欢迎来到我的博客</h2>
	</div>
</header><!-- /.masthead -->


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="/tags/#iOS" title="Pages tagged iOS">iOS</a>&nbsp;&bull;&nbsp;<a href="/tags/#UIView" title="Pages tagged UIView">UIView</a></span>
        
          <h1 class="entry-title">iOS UIView</h1>
        
      </header>
      <footer class="entry-meta">
        <img src="/images/bio-photo.jpg" alt="liu1529 photo" class="author-photo">
        <span class="author vcard">By <span class="fn"><a href="/about/" title="About liu1529">liu1529</a></span></span>
        <span class="entry-date date published"><time datetime="2014-09-11T00:00:00+08:00"><i class="icon-calendar-empty"></i> September 11, 2014</time></span>
        
        <span class="entry-comments"><i class="icon-comment-alt"></i> <a href="#disqus_thread">Comment</a></span>
        <span><a href="/iOS-views/" rel="bookmark" title="iOS UIView"><i class="icon-link"></i> Permalink</a></span>
        
      </footer>
      <div class="entry-content">
        <p>iOS里面可以说UIView是最重要的类之一，所有界面上的控件都是UIView的子类，UIView继承自UIResponder，UIResponder负责处理事件，而
UIResponder继承自NSObject。NSObject是Cocoa里面绝大部分类的根类。view hierarchy 是view最重要的组织形式，一个view可以拥有subviews，
而一个subview也有一个superview。view hierarchy使view一起出现和移动，当一个view移动时，它的所有subviews也一起移动；当一个view
被删除后，它的所有subviews也被一起删除。</p>

<h1 id="the-window">The Window</h1>

<p>view hierarchy的顶层元素是app的window，它是UIWindow的一个实例，并继承自UIView。app应该只有一个main window，而且一个屏幕只能
有一个window，它是界面上有效view的最终superview。window必须将设备的屏幕填充满：</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">UIWindow</span> <span class="o">*</span><span class="n">w</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:[[</span><span class="bp">UIScreen</span> <span class="n">maniScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span></code></pre></div>

<ul>
  <li>App 使用 main storyboard</li>
</ul>

<p>如果你的app使用main storyboard，那么UIApplicationMain会自动实例化一个正确的
UIWindow并将它赋值给app delegate的window属性，然后它会实例化storyboard的initial
view controller并将它赋值给window的rootViewController属性。这些都在app调用
<code>application:didFinnishLaunchingWithOptions</code>之前完成。
最后，UIApplicationMain会调用<code>makeKeyAndVisible</code>来显示app的界面，这些在调用<code>application:didFinnishLaunchingWithOptions</code>
之后完成。</p>

<p>如果你想子类化window时，你必须在AppDelegate.m文件里面重写window属性的getter函数:</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="p">-</span> <span class="p">(</span><span class="bp">UIWindow</span><span class="o">*</span><span class="p">)</span> <span class="nf">window</span> <span class="p">{</span>
<span class="bp">UIWindow</span><span class="o">*</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_window</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">w</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">w</span> <span class="o">=</span> <span class="p">[[</span><span class="n">MyWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span>
    <span class="p">[[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
    <span class="nb">self</span><span class="o">-&gt;</span><span class="n">_window</span> <span class="o">=</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">w</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<ul>
  <li>App 不使用 main storyboard</li>
</ul>

<p>如果你的app没有main storyboard，通常使用代码来完成：</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="nb">self</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:[[</span><span class="bp">UIScreen</span> <span class="n">mainScreen</span><span class="p">]</span> <span class="n">bounds</span><span class="p">]];</span>
<span class="c1">// Override point for customization after application launch.</span>
<span class="nb">self</span><span class="p">.</span><span class="n">window</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="n">whiteColor</span><span class="p">];</span>
<span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">window</span> <span class="n">makeKeyAndVisible</span><span class="p">];</span></code></pre></div>

<p>如果你想引用window属性，可以使用application的delegate中的window属性</p>

<p><code>UIWindow* w = [[[UIApplication sharedApplication] delegate] window]</code></p>

<h1 id="superview--subview">SuperView 和 SubView</h1>

<ul>
  <li>如果一个view在它的superview上移除或移动，它的所有subview也一起移除或移动。</li>
  <li>一个view的透明度将会被它的subview继承。</li>
  <li>如果view的subview的范围超出view的范围，可以不显示subview超出范围部分，这被称为clipping，通过clipsToBounds属性设置。</li>
  <li>superview负责管理它的subview，当一个subview不再属于它的superview或superview本身被释放时，superview负责释放它的subview。</li>
  <li>当view的尺寸被改变时，它的subview也可以自动改变。</li>
</ul>

<p>一个UIView有superview属性和subviews属性，<code>isDescendantOfView:</code>可以检测一个view是否
是另一个view的subview，不管深度有多深。如果你想引用一个特殊的view，你可以通过outlet，
或通过设置view的tag属性，然后使用<code>viewWithTag:</code>方法获得。</p>

<p><code>addSubview:</code>方法使一个view成为另一个的subview，<code>removeFromSuperview</code>方法将一个view
从它的superview的view hierarchy中移除。记住，一个view从它superview移除后，view
将会被释放，如果你还想使用它，你必须先保持(retain)它，通常通过设置属性的retain来完成。</p>

<p>当这些改变发生时，会发送事件通知，你需要通过子类化来重写这些事件，以处理事件。</p>

<ul>
  <li><code>didAddSubview:</code> <code>willRemoveSubview:</code></li>
  <li><code>didMoveToSuperview:</code> <code>willMoveToSuperview:</code> </li>
  <li><code>didMoveToWindow:</code> <code>willMoveToWindow:</code></li>
</ul>

<p><code>addSubview</code>会将view放在superview的最前端，你也可以通过下面的方法，将view插入到view
hierarchy的任意位置：</p>

<ul>
  <li><code>insertSubview:atIndex:</code></li>
  <li><code>insertSubview:belowSubvie:</code> <code>insertSubview:aboveSubview:</code></li>
  <li><code>exchangeSubviewAtIndex:withSubviewAtIndex:</code></li>
  <li><code>bringSubviewToFont:</code> <code>sendSubviewToBack:</code></li>
</ul>

<p>你可以通过下面的方法，删除所有subview。</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="k">for</span><span class="p">(</span><span class="bp">UIView</span> <span class="o">*</span><span class="n">v</span> <span class="k">in</span> <span class="n">view</span><span class="p">.</span><span class="n">subviews</span><span class="p">)</span>
    <span class="p">[</span><span class="n">v</span> <span class="n">removeFromSuperview</span><span class="p">];</span></code></pre></div>

<p>或</p>

<pre><code>[view.subviews makeObjectsPerformSelector:@selector(removeFromSuperview)];
</code></pre>

<h1 id="section">隐藏和透明</h1>

<p>通过设置UIView的属性hidden来隐藏view，当view隐藏后通常它不会再接收事件。</p>

<p>通过设置backgroundColor属性来设置view的背景色，当backgroundColor的属性为nil时，
它拥有一个透明背景。当它的属性为nil时，它可以作为其他views的superview，这样可以使
这些views在同一个view hierarchy中。</p>

<p>通过设置alpha属性，可以改变view的透明度（1.0表示不透明，0.0表示完全透明）。这将会
影响它的subviews，如果superview的alpha为0.5，那么它的subviews的alpha都不会超过0.5。
（更复杂的是颜色也有alpha属性，例如，一个view的alpha为1.0，它也可以拥有一个透明背景，
因为，它的backgroundColor的alpha小于1.0）。一个view完全透明，相当于设置hidden为YES，
它和它的subviews都会不可见，通常也不会在接收事件。</p>

<p>view的alpha属性同样会影响它背景色的可见度和它内容的可见度。例如，如果一个view的alpha
小于1，它显示一个图像且有背景色，背景色将会透过图像显示出来（view后面的任何东西都会
穿透显示）。</p>

<p>view的opaque属性，不会影响view透明度，它对绘制（drawing）系统有影响。当一个view
完全填充它的边界范围，且它的opaque为YES，且alpha属性为1.0，那么提高绘制系统的性能。</p>

<h1 id="frame">Frame</h1>

<p>view的frame属性，表示view在其superview坐标系中的位置和大小。坐标原点在左上角，
向右为x轴，向下为y轴。</p>

<h2 id="bounds-and-center">Bounds and Center</h2>

<p>bounds属性表示view在自己的坐标系中的位置和大小，<code>CGRectInset</code>可以很方便的
将一个view插入到另一个view中：</p>

<pre><code>UIView *v2 = [[UIView alloc] initWithFrame:CGRectInset(v1.bounds, 10, 10)];
</code></pre>

<p>改变view的bounds会影响它的frame，同样改变frame会影响bounds，但是改变bounds不会影响
view的center属性。center属性就像frame属性一样，代表view在其superview坐标系中位置，
但是它是bounds的中心位置，它的值就像如图下面表示：</p>

<pre><code>CGPoint center = CGPointMake(CGRectGetMidX(theView.bounds), 
                             CGRectGetMidY(theView.bounds));
</code></pre>

<p>view 的center是连接view的bounds和它superview的bounds的一个点，改变view的bounds不会改变center，改变center也不会改变bounds。</p>

<p>view的bounds和center可以清楚的描述view的大小和它在superview中的位置。view的frame属性是多余的，
实际上，frame仅仅用于方便的表达center和bounds的值。使用bounds和center来表示view的大小和它在
superview中所处的位置，更加的合理和可配置。</p>

<p>每个view都有自己的坐标系（boudns），自己的坐标系和superview坐标系的关系（center）。我们可以转换
在同一个窗口中任意两个view的坐标系，转换支持CGPoint和CGRect之间的双向转换。</p>

<ul>
  <li><code>convertPoint:fromVIew:</code> <code>convertPoint:toView:</code></li>
  <li><code>convertRect:fromView:</code> <code>convertRect:toView:</code></li>
</ul>

<p>如果，第二个参数为nil，表示window。</p>

<p>例如，如果v2是v1的subview，将v2放在v1的中间，可以使用：</p>

<pre><code>v2.center ＝ [v1 convertPoint:v1.center fromView:v1.superview];
</code></pre>

<blockquote>
  <p>当通过center来改变view的位置时，如果view的高或宽不是整数，view将会misaligned，view会显示不正
确。你可以在Simulator中通过Debug-&gt;Color Misaligned Images来检查。</p>
</blockquote>

<h2 id="transfom">Transfom</h2>

<p>view 的transform属性，在不改变view的bounds和center的前提下，改变view的大小和方向。transform是一个
CGAffineTransform类型，它相当于6个3＊3的矩阵，详细信息参考
“Transforms” chapter of Apple’s Quartz 2D Pro‐ gramming Guide, especially the section called “The Math Behind the Matrices.”
但是，你不需要知道这些细节，以<code>CGAffineTransformMake</code>开头的方法，提供了3个基本transform类型：旋转、放大缩小
、移动（translation）。第四种transform类型，比如倾斜、劈开，没有方便函数可供调用。</p>

<p>默认，view的变换矩阵被称为CGAffineTransformIndentity，应用任何transform都围绕center，center始终
保持不变。</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">UIView</span><span class="o">*</span> <span class="n">v1</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">113</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">194</span><span class="p">)];</span>
 <span class="n">v1</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">1</span> <span class="nl">green</span><span class="p">:</span><span class="mf">.4</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">1</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
 <span class="bp">UIView</span><span class="o">*</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectInset</span><span class="p">(</span><span class="n">v1</span><span class="p">.</span><span class="n">bounds</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)];</span>
 <span class="n">v2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">.5</span> <span class="nl">green</span><span class="p">:</span><span class="mi">1</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
 <span class="p">[</span><span class="n">mainview</span> <span class="nl">addSubview</span><span class="p">:</span> <span class="n">v1</span><span class="p">];</span>
 <span class="p">[</span><span class="n">v1</span> <span class="nl">addSubview</span><span class="p">:</span> <span class="n">v2</span><span class="p">];</span>
  <span class="n">v1</span><span class="p">.</span><span class="n">transform</span> <span class="o">=</span> <span class="n">CGAffineTransformMakeRotation</span><span class="p">(</span><span class="mi">45</span> <span class="o">*</span> <span class="n">M_PI</span><span class="o">/</span><span class="mf">180.0</span><span class="p">);</span></code></pre></div>

<p>上面演示了将v1旋转45度，v1的center和bounds都没有改变，所以v1的坐标系没有改变，v1的subview v2也
旋转45度，保持v2和v1的相对位置不变。这儿的规则是，如果view的transform不是identity transform，
那么你不应该设置它的frame。</p>

<pre><code>v1.transform ＝ CGAffineTransformMakeScale(1.8,1);
</code></pre>

<p>对v1的bounds和center同样没有影响，所以subview同样保持和v1相对位置不变。这意味着，v1和v2被同时
缩放。</p>

<p>应用给一个view的transform可以方便的给另一个view使用，这些方法的名字不不包含“Make”。这些方法不是
无序的，它们是有序的。</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">UIView</span><span class="o">*</span> <span class="n">v1</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">194</span><span class="p">)];</span>
<span class="n">v1</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">1</span> <span class="nl">green</span><span class="p">:</span><span class="mf">.4</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">1</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
<span class="bp">UIView</span><span class="o">*</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">v1</span><span class="p">.</span><span class="n">bounds</span><span class="p">];</span>
<span class="n">v2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">.5</span> <span class="nl">green</span><span class="p">:</span><span class="mi">1</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
<span class="p">[</span><span class="n">mainview</span> <span class="nl">addSubview</span><span class="p">:</span> <span class="n">v1</span><span class="p">];</span>
<span class="p">[</span><span class="n">v1</span> <span class="nl">addSubview</span><span class="p">:</span> <span class="n">v2</span><span class="p">];</span></code></pre></div>

<p>先右移100再旋转45度：</p>

<pre><code>v2.transform = CGAffineTransformMakeTranslation(100,0);
v2.transform = CGAffineTransformRotate(v2.transform, 45 * M_PI / 180.0);
</code></pre>

<p>和先旋转45度再右移100：</p>

<pre><code>v2.transform = CGAffineTransformMakeRotation(45 * M_PI / 180.0);
v2.transform = CGAffineTransformTranslate(v2.transform, 100.0);
</code></pre>

<p>会得到不同的图形。</p>

<p><code>CGAffineTransformConcat</code>方法使transform矩阵相乘，这也是有序的。先旋转45度再右移100也
可以使用下面的方法：</p>

<pre><code>CGAffineTransform r = CGAffineTransformMakeRotation(45 * M_PI / 180.0);
CGAffineTransform t = CGAffineTransformMakeTranslation(100, 0);
v2.transform = CGAffineTransformConcat(t,r); //not r,t
</code></pre>

<p>将已经存在的transform移除，使用对应的invert方法。例如，先旋转45度再右移100，最后移除旋转。</p>

<pre><code>CGAffineTransform r = CGAffineTransformMakeRotation(45 * M_PI / 180.0);
    CGAffineTransform t = CGAffineTransformMakeTranslation(100, 0); 
v2.transform = CGAffineTransformConcat(t, r);
v2.transform = CGAffineTransformConcat(CGAffineTransformInvert(r), v2.transform);
</code></pre>

<p>最后，没有方便的方法使图形倾斜，可以使用下面的方式：</p>

<pre><code>v1.transform = CGAffineTransformMake(1, 0, -0.2, 1.0, 0, 0);
</code></pre>

<p>transform可以应用再iOS的核心界面，window的frame和bounds都被锁定到屏幕，不能更改，但是root view
的frame和bounds可以被更改。当设备被旋转90度时，root view也被旋转了90度，{0,0}点移动到了用户的
右上角。root view的subviews在root view的坐标系中，拥有自己的frame，所以它们可以被正确的显示。</p>

<p>另外，root view的bounds的高和宽被交换，所以可能导致某些界面元素不能被显示出来，请查看下一节如何
解决这个问题。</p>

<h1 id="layout">layout</h1>

<p>我们已经知道，当superview的bounds的origin改变时，subview会移动。但是，当superview的bounds的size改变时，
 subview的bounds和center都不会改变，superview的bounds的origin也未改变，所以
subview保持在superview左上角的相对位置不变。在实际情况中，我们也许想要当superview的bounds的
size发生变化时，subview也能跟着变化，这被称为layout。</p>

<p>layout 有三种方法：</p>

<ul>
  <li>Manual layout</li>
</ul>

<p>当superview改变尺寸时，它会调用<code>layoutSubviews</code>方法。提供自己的subclass和重写<code>layoutSubviews</code>可以手动布局subview。</p>

<ul>
  <li>Autoresizing</li>
</ul>

<p>Autoresizing是iOS6之前的自动布局方法，当superview的尺寸变化时，subview根据它的属性autoresizingMask来调整自己尺寸。</p>

<ul>
  <li>Autolayout</li>
</ul>

<p>Autolayout在iOS6引进（和前面的系统不兼容），通过view的constraints设置。constraint不仅可以
用于view，还可以用于描述任意两个view之间的关系。constrain可以使你不通过代码，也能实现更加
复杂精确的layoutSubviews函数效果。</p>

<p>你也可以混用3种layout策略，需要manual layout的情况比较少见。Autoresizing自动使用，除非你
设置superview的autoresizeSubviews属性为NO，或者你在view种使用autolayout替代。Autolayout
是一个可选的技术，你可以用于任何你认为合适的地方，你也可以和autoresizing一起使用。</p>

<p>在Xcode5的storyboard和xib文件中默认使用autolayout，你可以在File inspector中选中或取消使用。
另一方面，你在代码中创建的界面，默认使用autoresizing，而不是autolayout。</p>

<h2 id="autoresizing">Autoresizing</h2>

<p>Autoresizing概念上相当于subview的“springs and struts”。spring 可以伸缩，strut不可以，springs和struts可以被设定为
内部的、外部的、水平的、垂直的。因此你可以通过内部springs和structs设置
view的缩放，使用外部springs和struts设置view的位置。例如：</p>

<p>1.一个subview在superview的中间并且保持在中间，但是当superview的size改变时，它的size也改变。
它拥有外部struct和内部spring。</p>

<p>2.一个subview在superview的中间并且保持，当superview的size改变时，它的size不改变。那么它
拥有内部struct和外部spring。</p>

<p>3.一个OK按钮始终在superview的右下角。那么它拥有内部的structs，外部的struts到它的右边和下边
，外部springs到它的上边和左边。</p>

<ol>
  <li>一个文本输入框在superview的上面，当superview变宽时它也变宽。那么它拥有外部struts，内部的
垂直strut和水平spring。</li>
</ol>

<p>在storyboard和xib中使用autoresizing，你需要先在File inspector中取消选中“Use Auto Layout”。
你可以使用Size inspector来设置view的spring和strut，外部的实线表示struct，内部的实线表示
spring。</p>

<p>在代码中，通过设置view的autoresizingMask属性，这是一个位属性，使用或操作来混用。可以使用
以<code>UIViewAutoresizingFlexible</code>开头的值来设置spring，不能用于设置strut。默认的UIViewAutoresizingNone，表示所有的strut，
但是实际上它不是所有的strut，它相当于UIViewAutoresizingFlexibleRightMargin和UIViewAutoresizingFlexibleBottomMargin.</p>

<div class="highlight"><pre><code class="language-objc" data-lang="objc"><span class="bp">UIView</span><span class="o">*</span> <span class="n">v1</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">194</span><span class="p">)];</span>
<span class="n">v1</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">1</span> <span class="nl">green</span><span class="p">:</span><span class="mf">.4</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">1</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
<span class="bp">UIView</span><span class="o">*</span> <span class="n">v2</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">10</span><span class="p">)];</span>
<span class="n">v2</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mf">.5</span> <span class="nl">green</span><span class="p">:</span><span class="mi">1</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
<span class="bp">UIView</span><span class="o">*</span> <span class="n">v3</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIView</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithFrame</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span>
													<span class="n">v1</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span>
													<span class="n">v1</span><span class="p">.</span><span class="n">bounds</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span>
														<span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">)];</span>
<span class="n">v3</span><span class="p">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIColor</span> <span class="nl">colorWithRed</span><span class="p">:</span><span class="mi">1</span> <span class="nl">green</span><span class="p">:</span><span class="mi">0</span> <span class="nl">blue</span><span class="p">:</span><span class="mi">0</span> <span class="nl">alpha</span><span class="p">:</span><span class="mi">1</span><span class="p">];</span>
<span class="p">[</span><span class="n">mainview</span> <span class="nl">addSubview</span><span class="p">:</span> <span class="n">v1</span><span class="p">];</span>
<span class="p">[</span><span class="n">v1</span> <span class="nl">addSubview</span><span class="p">:</span> <span class="n">v2</span><span class="p">];</span>
<span class="n">v1</span> <span class="nl">addSubview</span><span class="p">:</span> <span class="n">v3</span><span class="p">];</span>

<span class="n">v2</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span> <span class="n">UIViewAutoresizingFlexibleWidth</span><span class="p">;</span>
<span class="n">v3</span><span class="p">.</span><span class="n">autoresizingMask</span> <span class="o">=</span> <span class="n">UIViewAutoresizingFlexibleTopMargin</span> <span class="o">|</span>
                          <span class="n">UIViewAutoresizingFlexibleLeftMargin</span><span class="p">;</span>
<span class="bp">CGRect</span> <span class="n">r</span> <span class="o">=</span> <span class="n">v1</span><span class="p">.</span><span class="n">bounds</span><span class="p">;</span>
<span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">width</span> <span class="o">+=</span> <span class="mi">40</span><span class="p">;</span>
<span class="n">r</span><span class="p">.</span><span class="n">size</span><span class="p">.</span><span class="n">height</span> <span class="o">-=</span> <span class="mi">50</span><span class="p">;</span>
<span class="n">v1</span><span class="p">.</span><span class="n">bounds</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span></code></pre></div>

<p>上面的代码中，当v1的size改变时，v2的宽度也会跟着改变，v3的大小不会改变，它会一直在v1的右下角位置不变。</p>

<p>当你旋转屏幕后，你的view也应该正确的旋转：</p>

<pre><code>v1.frame = mainview.bounds;
v1.autoresizingMask = UIViewAutoresizingFlexibleHeight |
                      UIViewAutoresizingFlexibleWidth;
</code></pre>

<p>Autoresizing简单有效，但是有时它太简单了。它只能描述suview和superview之间的关系。<code>layoutSubviews</code>,
方法在autoresizing后调用，所以你的<code>layoutSubviews</code>可以修正和改变autoresizing没有正确处理的部分。</p>

<h1 id="autolayout">Autolayout</h1>

<p>Autolayout可能在如下三种情况发生时使用：</p>

<ol>
  <li>你的代码中，向view加入autolayout constraint。</li>
  <li>你的app中nib或storyboard选中“Use Auto Layout”，每个nib的view实例将使用autolayout。</li>
  <li>在你的UIView子类中，重写方法<code>requiresConstraintBasedLayout</code>返回YES。</li>
</ol>

<p>第3中方法，主要用于在切换到autolayout，并在代码添加constraints。通常通过实现view的
<code>updateConstraints</code>方法，在代码中添加constrains，但是如果<code>requiresConstraintBasedLayout</code>
返回NO，那么将不会调用<code>updateConstraints</code>。</p>

<p>一个superview使用autolayout，它的一个或所有subview可以不使用。但是，autolayout会穿透superview
链，所以一个view使用autolayout，那么它的所有superview都会使用autolayout。如果这些view中
有一个view是view controller的main view，那么view controller也会使用autolayout。</p>

<h2 id="constraints">Constraints</h2>

<p>Autolayout constraints 是一个NSLayoutConstraint实例，用于描述view的绝对高度和宽度，或者
描述一个view和另一个view之间的关系，两个view之间只要有共同的祖先皆可。</p>

<p>NSLayoutConstraint重要的属性如下：</p>

<ol>
  <li>firstItem, firstAttribute, secondItem, secondAttribute</li>
</ol>

<p>这个constrain包含两个view各自的属性，如果constrain描述的是view的绝对高度和宽度，第二个view
位nil，第二个view的属性是NSLayoutAttributeNotAnAttribute，其余的属性值：</p>

<ul>
  <li>NSLayoutAttributeLeft,NSLayoutAttributeRight</li>
  <li>NSLayoutAttributeTop,NSLayoutAttributeBottom</li>
  <li>NSLayoutAttributeLeading,NSLayoutAttributeTrailing  </li>
  <li>NSLayoutAttributeWidth,NSLayoutAttributeHeight</li>
  <li>NSLayoutAttributeCenterX,NSLayoutAttributeCenterY </li>
  <li>NSLayoutAttributeBaseline</li>
</ul>

<p>NSLayoutAttributeLeading、NSLayoutAttributeTrailing相当于国际上的NSLayoutAttributeLeft、
NSLayoutAttributeRight，在书写顺序为从右往左国家，它会自动翻转顺序。</p>

<ol>
  <li>multiplier, constant</li>
</ol>

<p>用于设定第一个属性的值，比如满足等式“第一个属性的值＝第二个属性的值 * multiplier + constant”</p>

<ol>
  <li>relation</li>
</ol>

<p>用于设置第2点中等式的操作符，操作符可以可能是等号（NSLayoutRelationEqual），也可能是不等式
NSLayoutRelationLessThanOrEqual, NSLayoutRelationGreaterThanOrEqual</p>

<ol>
  <li>priority</li>
</ol>

<p>优先级从1到1000</p>

<p>一个view可以有多个constraint，UIView有一个constraints属性，通过下面方法添加或删除constrain</p>

<ul>
  <li>addConstraint:,addConstraints:</li>
  <li>removeConstraint:,removeConstraints:</li>
</ul>

<p>对于给出的一个constrain，它属于谁呢？它属于它们两个view最近的superview。因此，如果constrain
指示view的绝对高度，那么它属于这个view。如果它描述两个同级view的关系，那么它属于这个两个view的
superview。如果它描述view和它superview之间的关系，那么它属于superview。</p>

<p>NSLayoutConstraint的属性除了priority和constant都是只读的，如果你想改变已经存在的constraint，
你必须先删除它，再重新添加。</p>

<h2 id="autoresizing-constraints">Autoresizing constraints</h2>

<p>view的autolayout机制，可能会导致在以前没有使用autolayout的view中引入autolayout。因此，必须
有一种方式，保证当view引入autolayout的时候，它和通过设置frame和autoresizingMask的位置相同。
系统有一个隐士的NSAutoresizingMaskLayoutConstraint来转换为正确的contraint。</p>

<p>例如，你有一个UILabel的frame是{{20,20},{42,22}}，autoresizingMask为UIViewAutoresizingNone，
如果它突然加入autolayout，它superview会转换它的隐士constrain，它的宽为42、高为22，center X为41，
center Y为31.</p>

<p>这个转换发生在view的translatesAutoresizingMaskIntoConstraints属性为YES。如果你想要添加
任何清晰的constrain到view，你需要设置translatesAutoresizingMaskIntoConstraints为NO。
否则可能会产生冲突。</p>

<h2 id="constraints-1">代码中创建constraints</h2>


        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="/RTThread-context-switch/" class="btn" title="嵌入式操作系统的上下文切换">Previous article</a>
      
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 liu1529. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/so-simple/">So Simple Theme</a>.</span>
<div class="social-icons">
	
	
	
	
	
	
	
	
	
</div><!-- /.social-icons -->
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'liu1529'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>	        

</body>
</html>
